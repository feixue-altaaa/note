# MySQL 中有哪些常见日志？

- 重做日志（redo log）：物理日志
  - 作用是确保事务的持久性。 redo 日志记录事务执行后的状态，用来恢复未写入 data file 的已提交事务数据。
- 回滚日志（undo log）：逻辑日志
  - 作用是保证数据的原子性。 保存了事务发生之前的数据的一个版本，可以用于回滚，同时可以提供多版本并发控制下的读（MVCC），也即非锁定读。
- 二进制日志（binlog）：逻辑日志
  - 常用于主从同步或数据同步中，也可用于数据库基于时间点的还原。
- 错误日志（errorlog）
  - 记录着 MySQL 启动和停止，以及服务器在运行过程中发生的错误的相关信息。在默认情况下，系统记录错误日志的功能是关闭的，错误信息被输出到标准错误输出。
- 普通查询日志（general query log）
  - 记录了服务器接收到的每一个命令，无论命令语句是否正确，因此会带来不小开销，所以也是默认关闭的。
- 慢查询日志（slow query log）
  - 记录执行时间过长和没有使用索引的查询语句（默认 10s），同时只会记录执行成功的语句。
- 中继日志（relay log）
  - 在从节点中存储接收到的 binlog 日志内容，用于主从同步

# 什么是异步复制和半同步？

MySQL 的主从复制有两种复制方式，分别是异步复制和半同步复制

## 异步复制

MySQL 默认的主从复制方式就是异步复制，因为 Master 根本不考虑数据是否达到了 Slave，或 Slave 是否成功执行

如过需要实现完全同步方式，即 Master 需要等待一个或所有 Slave 执行成功后才响应成功，那集群效率可想而知。故 MySQL 5.6 之后出现了一种折中的方式——半同步

## 半同步复制

一主一从，一主多从情况下，Master 节点只要确认至少有一个 Slave 接受到了事务，即可向发起请求的客户端返回执行成功的操作。同时 Master 是不需要等待 Slave 成功执行完这个事务，Slave 节点接受到这个事务，并成功写入到本地 relay 日志中就算成功

另外，在半同步复制时，如果主库的一个事务提交成功了，在推送到从库的过程当中，从库宕机了或网络故障，导致从库并没有接收到这个事务的Binlog，此时主库会等待一段时间（这个时间由rpl_semi_sync_master_timeout的毫秒数决定），如果这个时间过后还无法推送到从库，那 MySQL 会自动从半同步复制切换为异步复制，当从库恢复正常连接到主库后，主库又会自动切换回半同步复制

半同步复制的“半”体现在，虽然主从库的Binlog是同步的，但主库不会等待从库执行完Relay-log后才返回，而是确认从库接收到Binlog，达到主从Binlog同步的目的后就返回了，所以从库的数据对于主库来说还是有延时的，这个延时就是从库执行Relay-log的时间。所以只能称为半同步
# 一条 SQL 是如何执行的？

![在这里插入图片描述](https://raw.githubusercontent.com/feixue-altaaa/picture/master/pic/202306282144036.png)

# 大表查询如何优化？

**分库分表、读写分离以及缓存**